/*
enchant.js v0.4.3
Copyright (c) Ubiquitous Entertainment Inc.
Dual licensed under the MIT or GPL Version 3 licenses
http://www.opensource.org/licenses/mit-license.php
http://www.gnu.org/licenses/gpl-3.0.html
*/
"function"!=typeof Object.defineProperty&&(Object.defineProperty=function(f,l,n){"value"in n&&(f[l]=n.value);"get"in n&&f.__defineGetter__(l,n.get);"set"in n&&f.__defineSetter__(l,n.set);return f});"function"!=typeof Object.defineProperties&&(Object.defineProperties=function(f,l){for(var n in l)l.hasOwnProperty(n)&&Object.defineProperty(f,n,l[n]);return f});
"function"!==typeof Object.create&&(Object.create=function(f,l){function n(){}n.prototype=f;var p=new n;l!==null&&Object.defineProperties(p,l);return p});"function"!=typeof Object.getPrototypeOf&&(Object.getPrototypeOf=function(f){return f.__proto__});
var enchant=function(f){if(f!==null){f instanceof Array||(f=Array.prototype.slice.call(arguments));f=f.filter(function(f){return""+f})}(function n(p,q){var c=[],o;for(o in p)if(p.hasOwnProperty(o))if(typeof p[o]=="function")window[o]=p[o];else if(typeof p[o]=="object"&&Object.getPrototypeOf(p[o])==Object.prototype)if(f===null)c.push(o);else{a=f.indexOf(q+o);if(a!=-1){c.push(o);f.splice(a,1)}}var a=0;for(o=c.length;a<o;a++)n(p[c[a]],q+c[a]+".")})(enchant,"");if(f!==null&&f.length)throw Error("Cannot load module: "+
f.join(", "));};
(function(){function f(a){var b=a.match(/\.\w+$/);return b&&b.length>0?b[0].slice(1).toLowerCase():a.indexOf("data:")===0?a.split(/[\/;]/)[1].toLowerCase():null}var l=function(){var a=navigator.userAgent;return a.indexOf("Opera")!=-1?"O":a.indexOf("MSIE")!=-1?"ms":a.indexOf("WebKit")!=-1?"webkit":navigator.product=="Gecko"?"Moz":""}(),n=function(){var a=document.createElement("div");a.setAttribute("ontouchstart","return");return typeof a.ontouchstart=="function"}(),p=function(){if(navigator.userAgent.indexOf("iPhone")!=-1&&
window.devicePixelRatio==2){var a=document.querySelector('meta[name="viewport"]');if(a==null){a=document.createElement("meta");document.head.appendChild(a)}a.setAttribute("content","width=640px");return true}return false}(),q=function(){var a=navigator.userAgent,b=navigator.vendor;return location.href.indexOf("http")===0&&a.indexOf("Mobile")==-1&&b.indexOf("Apple")!=-1}(),c;enchant.Class=function(a,b){return enchant.Class.create(a,b)};enchant.Class.create=function(a,b){if(arguments.length===0)return enchant.Class.create(Object,
b);if(arguments.length==1&&typeof arguments[0]!="function")return enchant.Class.create(Object,arguments[0]);for(var e in b)if(b.hasOwnProperty(e))if(typeof b[e]=="object"&&Object.getPrototypeOf(b[e])==Object.prototype){if(!("enumerable"in b[e]))b[e].enumerable=true}else b[e]={value:b[e],enumerable:true,writable:true};var d=function(){if(this instanceof d)d.prototype.initialize.apply(this,arguments);else return new d};d.prototype=Object.create(a.prototype,b);d.prototype.Constructor=d;if(d.prototype.initialize==
null)d.prototype.initialize=function(){a.apply(this,arguments)};return d};enchant.Event=enchant.Class.create({initialize:function(a){this.type=a;this.target=null;this.localY=this.localX=this.y=this.x=0},_initPosition:function(a,b){this.x=this.localX=(a-c._pageX)/c.scale;this.y=this.localY=(b-c._pageY)/c.scale}});enchant.Event.LOAD="load";enchant.Event.PROGRESS="progress";enchant.Event.ENTER_FRAME="enterframe";enchant.Event.EXIT_FRAME="exitframe";enchant.Event.ENTER="enter";enchant.Event.EXIT="exit";
enchant.Event.ADDED="added";enchant.Event.ADDED_TO_SCENE="addedtoscene";enchant.Event.REMOVED="removed";enchant.Event.REMOVED_FROM_SCENE="removedfromscene";enchant.Event.TOUCH_START="touchstart";enchant.Event.TOUCH_MOVE="touchmove";enchant.Event.TOUCH_END="touchend";enchant.Event.RENDER="render";enchant.Event.INPUT_START="inputstart";enchant.Event.INPUT_CHANGE="inputchange";enchant.Event.INPUT_END="inputend";enchant.Event.LEFT_BUTTON_DOWN="leftbuttondown";enchant.Event.LEFT_BUTTON_UP="leftbuttonup";
enchant.Event.RIGHT_BUTTON_DOWN="rightbuttondown";enchant.Event.RIGHT_BUTTON_UP="rightbuttonup";enchant.Event.UP_BUTTON_DOWN="upbuttondown";enchant.Event.UP_BUTTON_UP="upbuttonup";enchant.Event.DOWN_BUTTON_DOWN="downbuttondown";enchant.Event.DOWN_BUTTON_UP="downbuttonup";enchant.Event.A_BUTTON_DOWN="abuttondown";enchant.Event.A_BUTTON_UP="abuttonup";enchant.Event.B_BUTTON_DOWN="bbuttondown";enchant.Event.B_BUTTON_UP="bbuttonup";enchant.EventTarget=enchant.Class.create({initialize:function(){this._listeners=
{}},addEventListener:function(a,b){var e=this._listeners[a];e==null?this._listeners[a]=[b]:e.indexOf(b)==-1&&e.unshift(b)},removeEventListener:function(a,b){var e=this._listeners[a];if(e!=null){var d=e.indexOf(b);d!=-1&&e.splice(d,1)}},clearEventListener:function(a){a!==null?delete this._listeners[a]:this._listeners={}},dispatchEvent:function(a){a.target=this;a.localX=a.x-this._offsetX;a.localY=a.y-this._offsetY;if(this["on"+a.type]!=null)this["on"+a.type]();var b=this._listeners[a.type];if(b!=null)for(var b=
b.slice(),e=0,d=b.length;e<d;e++)b[e].call(this,a)}});enchant.Game=enchant.Class.create(enchant.EventTarget,{initialize:function(a,b){if(window.document.body==null)throw Error("document.body is null. Please excute 'new Game()' in window.onload.");enchant.EventTarget.call(this);var e=true;if(c){e=false;c.stop()}c=enchant.Game.instance=this;this.width=a||320;this.height=b||320;this.scale=1;var d=document.getElementById("enchant-stage");if(d){var j=window.getComputedStyle(d),a=parseInt(j.width,10),b=
parseInt(j.height,10);if(a&&b)this.scale=Math.min(a/this.width,b/this.height);else{d.style.width=this.width+"px";d.style.height=this.height+"px"}for(;d.firstChild;)d.removeChild(d.firstChild);d.style.position="relative";j=d.getBoundingClientRect();this._pageX=Math.round(window.scrollX+j.left);this._pageY=Math.round(window.scrollY+j.top)}else{d=document.createElement("div");d.id="enchant-stage";d.style.width=window.innerWidth+"px";d.style.height=window.innerHeight+"px";d.style.position="absolute";
document.body.firstChild?document.body.insertBefore(d,document.body.firstChild):document.body.appendChild(d);this.scale=Math.min(window.innerWidth/this.width,window.innerHeight/this.height);this._pageY=this._pageX=0}if(!this.scale)this.scale=1;d.style.fontSize="12px";d.style.webkitTextSizeAdjust="none";this._element=d;this.fps=30;this.frame=0;this.ready=null;this.running=false;this.assets={};var g=this._assets=[];(function u(a){a.assets instanceof Array&&[].push.apply(g,a.assets);for(var b in a)a.hasOwnProperty(b)&&
typeof a[b]=="object"&&Object.getPrototypeOf(a[b])==Object.prototype&&u(a[b])})(enchant);this._scenes=[];this.currentScene=null;this.rootScene=new enchant.Scene;this.pushScene(this.rootScene);this.loadingScene=new enchant.Scene;this.loadingScene.backgroundColor="#000";var m=this.width*0.9|0,k=this.width*0.3|0,h=m*0.05|0,j=new enchant.Sprite(m,k);j.x=(this.width-m)/2;j.y=(this.height-k)/2;var i=new enchant.Surface(m,k);i.context.fillStyle="#fff";i.context.fillRect(0,0,m,k);i.context.fillStyle="#000";
i.context.fillRect(h,h,m-h*2,k-h*2);j.image=i;var f=0,l=0;this.addEventListener("progress",function(a){f=a.loaded/a.total});j.addEventListener("enterframe",function(){l=l*0.9;l=l+f*0.1;i.context.fillStyle="#fff";i.context.fillRect(h,0,(m-h*2)*l,k)});this.loadingScene.addChild(j);this._soundID=this._surfaceID=this._mousedownID=0;this._intervalID=null;this.input={};this._keybind={};this.keybind(37,"left");this.keybind(38,"up");this.keybind(39,"right");this.keybind(40,"down");var o=0;["left","right",
"up","down","a","b"].forEach(function(a){this.addEventListener(a+"buttondown",function(b){if(!this.input[a]){this.input[a]=true;this.dispatchEvent(new enchant.Event(o++?"inputchange":"inputstart"))}this.currentScene.dispatchEvent(b)});this.addEventListener(a+"buttonup",function(b){if(this.input[a]){this.input[a]=false;this.dispatchEvent(new enchant.Event(--o?"inputchange":"inputend"))}this.currentScene.dispatchEvent(b)})},this);if(e){d.addEventListener("keydown",function(a){c.dispatchEvent(new enchant.Event("keydown"));
if(37<=a.keyCode&&a.keyCode<=40||a.keyCode==32){a.preventDefault();a.stopPropagation()}if(c.running)if(a=c._keybind[a.keyCode]){a=new enchant.Event(a+"buttondown");c.dispatchEvent(a)}},true);d.addEventListener("keyup",function(a){if(c.running)if(a=c._keybind[a.keyCode]){a=new enchant.Event(a+"buttonup");c.dispatchEvent(a)}},true);if(n){d.addEventListener("touchstart",function(a){a.preventDefault()},true);d.addEventListener("touchmove",function(a){a.preventDefault();c.running||a.stopPropagation()},
true);d.addEventListener("touchend",function(a){a.preventDefault();c.running||a.stopPropagation()},true)}else{d.addEventListener("mousedown",function(a){var b=a.target.tagName.toLowerCase();if(b!=="input"&&b!=="textarea"){a.preventDefault();c._mousedownID++;c.running||a.stopPropagation()}},true);d.addEventListener("mousemove",function(a){var b=a.target.tagName.toLowerCase();if(b!=="input"&&b!=="textarea"){a.preventDefault();c.running||a.stopPropagation()}},true);d.addEventListener("mouseup",function(a){var b=
a.target.tagName.toLowerCase();if(b!=="input"&&b!=="textarea"){a.preventDefault();c.running||a.stopPropagation()}},true)}}},preload:function(a){a instanceof Array||(a=Array.prototype.slice.call(arguments));[].push.apply(this._assets,a)},load:function(a,b){b===null&&(b=function(){});var e=f(a);switch(e){case "jpg":case "jpeg":case "gif":case "png":case "bmp":c.assets[a]=enchant.Surface.load(a);c.assets[a].addEventListener("load",b);break;case "mp3":case "aac":case "m4a":case "wav":case "ogg":c.assets[a]=
enchant.Sound.load(a,"audio/"+e);c.assets[a].addEventListener("load",b);break;default:var d=new XMLHttpRequest;d.open("GET",a,true);d.onreadystatechange=function(){if(d.readyState==4){if(d.status!=200&&d.status!==0)throw Error(d.status+": Cannot load an asset: "+a);var e=d.getResponseHeader("Content-Type")||"";if(e.match(/^image/)){c.assets[a]=enchant.Surface.load(a);c.assets[a].addEventListener("load",b)}else if(e.match(/^audio/)){c.assets[a]=enchant.Sound.load(a,e);c.assets[a].addEventListener("load",
b)}else{c.assets[a]=d.responseText;b()}}};d.send(null)}},start:function(){if(this._intervalID)window.clearInterval(this._intervalID);else if(this._assets.length){if(enchant.Sound.enabledInMobileSafari&&!c._touched&&l=="webkit"&&n){var a=new enchant.Scene;a.backgroundColor="#000";var b=Math.round(c.width/10),e=new enchant.Sprite(c.width,b);e.y=(c.height-b)/2;e.image=new enchant.Surface(c.width,b);e.image.context.fillStyle="#fff";e.image.context.font=b-1+"px bold Helvetica,Arial,sans-serif";var d=e.image.context.measureText("Touch to Start").width;
e.image.context.fillText("Touch to Start",(c.width-d)/2,b-1);a.addChild(e);document.addEventListener("touchstart",function(){c._touched=true;c.removeScene(a);c.start()},true);c.pushScene(a);return}var j={},b=this._assets.filter(function(a){return a in j?false:j[a]=true}),g=0,m=b.length,e=function(){var a=new enchant.Event("progress");a.loaded=++g;a.total=m;c.dispatchEvent(a);if(g==m){c.removeScene(c.loadingScene);c.dispatchEvent(new enchant.Event("load"))}},d=0;for(;d<m;d++)this.load(b[d],e);this.pushScene(this.loadingScene)}else this.dispatchEvent(new enchant.Event("load"));
this.currentTime=Date.now();this._intervalID=window.setInterval(function(){c._tick()},1E3/this.fps);this.running=true},debug:function(){this._debug=true;this.rootScene.addEventListener("enterframe",function(a){this._actualFps=1/a});this.start()},actualFps:{get:function(){return this._actualFps||this.fps}},_tick:function(){var a=Date.now(),b=new enchant.Event("enterframe");b.elapsed=a-this.currentTime;this.currentTime=a;for(var a=this.currentScene.childNodes.slice(),e=Array.prototype.push;a.length;){var d=
a.pop();d.dispatchEvent(b);d.age++;d.childNodes&&e.apply(a,d.childNodes)}this.currentScene.dispatchEvent(b);this.dispatchEvent(b);this.dispatchEvent(new enchant.Event("exitframe"));this.frame++},stop:function(){if(this._intervalID){window.clearInterval(this._intervalID);this._intervalID=null}this.running=false},pause:function(){if(this._intervalID){window.clearInterval(this._intervalID);this._intervalID=null}},resume:function(){this.currentTime=Date.now();this._intervalID=window.setInterval(function(){c._tick()},
1E3/this.fps);this.running=true},pushScene:function(a){this._element.appendChild(a._element);this.currentScene&&this.currentScene.dispatchEvent(new enchant.Event("exit"));this.currentScene=a;this.currentScene.dispatchEvent(new enchant.Event("enter"));return this._scenes.push(a)},popScene:function(){if(this.currentScene==this.rootScene)return this.currentScene;this._element.removeChild(this.currentScene._element);this.currentScene.dispatchEvent(new enchant.Event("exit"));this.currentScene=this._scenes[this._scenes.length-
2];this.currentScene.dispatchEvent(new enchant.Event("enter"));return this._scenes.pop()},replaceScene:function(a){this.popScene();return this.pushScene(a)},removeScene:function(a){if(this.currentScene==a)return this.popScene();var b=this._scenes.indexOf(a);if(b!=-1){this._scenes.splice(b,1);this._element.removeChild(a._element);return a}return null},keybind:function(a,b){this._keybind[a]=b}});enchant.Game.instance=null;enchant.Node=enchant.Class.create(enchant.EventTarget,{initialize:function(){enchant.EventTarget.call(this);
this.age=this._offsetY=this._offsetX=this._y=this._x=0;this.scene=this.parentNode=null;this.addEventListener("touchstart",function(a){this.parentNode&&this.parentNode!=this.scene&&this.parentNode.dispatchEvent(a)});this.addEventListener("touchmove",function(a){this.parentNode&&this.parentNode!=this.scene&&this.parentNode.dispatchEvent(a)});this.addEventListener("touchend",function(a){this.parentNode&&this.parentNode!=this.scene&&this.parentNode.dispatchEvent(a)})},moveTo:function(a,b){this._x=a;this._y=
b;this._updateCoordinate()},moveBy:function(a,b){this._x=this._x+a;this._y=this._y+b;this._updateCoordinate()},x:{get:function(){return this._x},set:function(a){this._x=a;this._updateCoordinate()}},y:{get:function(){return this._y},set:function(a){this._y=a;this._updateCoordinate()}},_updateCoordinate:function(){if(this.parentNode){this._offsetX=this.parentNode._offsetX+this._x;this._offsetY=this.parentNode._offsetY+this._y}else{this._offsetX=this._x;this._offsetY=this._y}},remove:function(){this._listener&&
this.clearEventListener();this.parentNode&&this.removeChild(this)}});enchant.Entity=enchant.Class.create(enchant.Node,{initialize:function(){enchant.Node.call(this);this._element=document.createElement("div");this._style=this._element.style;this._style.position="absolute";this._height=this._width=0;this._backgroundColor=null;this._opacity=1;this._visible=true;this._buttonMode=null;if(enchant.Game.instance._debug){this._style.border="1px solid blue";this._style.margin="-1px"}this.buttonMode=null;this.buttonPressed=
false;this.addEventListener("touchstart",function(){if(this.buttonMode){this.buttonPressed=true;var a=new enchant.Event(this.buttonMode+"buttondown");this.dispatchEvent(a);c.dispatchEvent(a)}});this.addEventListener("touchend",function(){if(this.buttonMode){this.buttonPressed=false;var a=new enchant.Event(this.buttonMode+"buttonup");this.dispatchEvent(a);c.dispatchEvent(a)}});var a=this,b=function(){a.dispatchEvent(new enchant.Event("render"))};this.addEventListener("addedtoscene",function(){b();
c.addEventListener("exitframe",b)});this.addEventListener("removedfromscene",function(){c.removeEventListener("exitframe",b)});this.addEventListener("render",function(){if(this._offsetX!=this._previousOffsetX)this._style.left=this._offsetX+"px";if(this._offsetY!=this._previousOffsetY)this._style.top=this._offsetY+"px";this._previousOffsetX=this._offsetX;this._previousOffsetY=this._offsetY});if(n){this._element.addEventListener("touchstart",function(b){for(var d=b.touches,c=0,g=d.length;c<g;c++){b=
new enchant.Event("touchstart");b.identifier=d[c].identifier;b._initPosition(d[c].pageX,d[c].pageY);a.dispatchEvent(b)}},false);this._element.addEventListener("touchmove",function(b){for(var d=b.touches,c=0,g=d.length;c<g;c++){b=new enchant.Event("touchmove");b.identifier=d[c].identifier;b._initPosition(d[c].pageX,d[c].pageY);a.dispatchEvent(b)}},false);this._element.addEventListener("touchend",function(b){for(var d=b.changedTouches,c=0,g=d.length;c<g;c++){b=new enchant.Event("touchend");b.identifier=
d[c].identifier;b._initPosition(d[c].pageX,d[c].pageY);a.dispatchEvent(b)}},false)}else{this._element.addEventListener("mousedown",function(b){var d=b.pageX,j=b.pageY,b=new enchant.Event("touchstart");b.identifier=c._mousedownID;b._initPosition(d,j);a.dispatchEvent(b);a._mousedown=true},false);c._element.addEventListener("mousemove",function(b){if(a._mousedown){var d=b.pageX,j=b.pageY,b=new enchant.Event("touchmove");b.identifier=c._mousedownID;b._initPosition(d,j);a.dispatchEvent(b)}},false);c._element.addEventListener("mouseup",
function(b){if(a._mousedown){var d=b.pageX,j=b.pageY,b=new enchant.Event("touchend");b.identifier=c._mousedownID;b._initPosition(d,j);a.dispatchEvent(b);a._mousedown=false}},false)}},id:{get:function(){return this._element.id},set:function(a){this._element.id=a}},className:{get:function(){return this._element.className},set:function(a){this._element.className=a}},width:{get:function(){return this._width},set:function(a){this._style.width=(this._width=a)+"px"}},height:{get:function(){return this._height},
set:function(a){this._style.height=(this._height=a)+"px"}},backgroundColor:{get:function(){return this._backgroundColor},set:function(a){this._element.style.backgroundColor=this._backgroundColor=a}},opacity:{get:function(){return this._opacity},set:function(a){this._style.opacity=this._opacity=a}},visible:{get:function(){return this._visible},set:function(a){this._visible=a;this._style.display=a?"block":"none"}},touchEnabled:{get:function(){return this._touchEnabled},set:function(a){this._touchEnabled=
a;this._style.pointerEvents=a?"all":"none"}},intersect:function(a){return this.x<a.x+a.width&&a.x<this.x+this.width&&this.y<a.y+a.height&&a.y<this.y+this.height},within:function(a,b){b===null&&(b=(this.width+this.height+a.width+a.height)/4);var e;return(e=this.x-a.x+(this.width-a.width)/2)*e+(e=this.y-a.y+(this.height-a.height)/2)*e<b*b}});enchant.Sprite=enchant.Class.create(enchant.Entity,{initialize:function(a,b){enchant.Entity.call(this);this.width=a;this.height=b;this._scaleY=this._scaleX=1;this._rotation=
0;this._dirty=false;this._image=null;this._frame=0;this._frameSequence=[];this._style.overflow="hidden";this.addEventListener("render",function(){if(this._dirty){this._style[l+"Transform"]=["rotate(",this._rotation,"deg)scale(",this._scaleX,",",this._scaleY,")"].join("");this._dirty=false}});this.addEventListener("enterframe",function(){if(this._frameSequence.length!==0){var a=this._frameSequence.shift();if(a==null)this._frameSequence=[];else{this._setFrame(a);this._frameSequence.push(a)}}});if(enchant.Game.instance._debug){this._style.border=
"1px solid red";this._style.margin="-1px";this.addEventListener("touchstart",function(){enchant.Game.instance.running||console.log("touchstart",this)})}},image:{get:function(){return this._image},set:function(a){if(a!=this._image){if(this._image!=null)if(this._image.css)this._style.backgroundImage="";else if(this._element.firstChild){this._element.removeChild(this._element.firstChild);if(this._dirtyListener){this.removeEventListener("render",this._dirtyListener);this._dirtyListener=null}else this._image._parent=
null}if(a!=null)if(a._css)this._style.backgroundImage=a._css;else if(a._parent){var b=document.createElement("canvas"),e=b.getContext("2d");b.width=a.width;b.height=a.height;e.drawImage(a._element,0,0);this._dirtyListener=function(){if(a._dirty){e.drawImage(a._element);a._dirty=false}};this.addEventListener("render",this._dirtyListener);this._element.appendChild(b)}else{a._parent=this;this._element.appendChild(a._element)}this._image=a}}},frame:{get:function(){return this._frame},set:function(a){if(a instanceof
Array){var b=a.shift();this._setFrame(b);a.push(b);this._frameSequence=a}else{this._setFrame(a);this._frameSequence=[];this._frame=a}}},_setFrame:function(a){if(this._image!=null){this._frame=a;var b=this._image.width/this._width|0;if(this._image._css)this._style.backgroundPosition=[-(a%b)*this._width,"px ",-(a/b|0)*this._height,"px"].join("");else if(this._element.firstChild){var e=this._element.firstChild.style;e.left=-(a%b)*this._width+"px";e.top=-(a/b|0)*this._height+"px"}}},scale:function(a,
b){this._scaleX=this._scaleX*a;this._scaleY=this._scaleY*(b===null?a:b);this._dirty=true},rotate:function(a){this._rotation=this._rotation+a;this._dirty=true},scaleX:{get:function(){return this._scaleX},set:function(a){this._scaleX=a;this._dirty=true}},scaleY:{get:function(){return this._scaleY},set:function(a){this._scaleY=a;this._dirty=true}},rotation:{get:function(){return this._rotation},set:function(a){this._rotation=a;this._dirty=true}}});enchant.Label=enchant.Class.create(enchant.Entity,{initialize:function(a){enchant.Entity.call(this);
this.width=300;this.text=a},text:{get:function(){return this._element.innerHTML},set:function(a){this._element.innerHTML=a}},font:{get:function(){return this._style.font},set:function(a){this._style.font=a}},color:{get:function(){return this._style.color},set:function(a){this._style.color=a}}});enchant.Map=enchant.Class.create(enchant.Entity,{initialize:function(a,b){enchant.Entity.call(this);var e=document.createElement("canvas");if(p&&c.scale==2){e.width=c.width*2;e.height=c.height*2;this._style.webkitTransformOrigin=
"0 0";this._style.webkitTransform="scale(0.5)"}else{e.width=c.width;e.height=c.height}this._element.appendChild(e);this._context=e.getContext("2d");this._tileWidth=a||0;this._tileHeight=b||0;this._image=null;this._data=[[[]]];this.touchEnabled=this._tight=this._dirty=false;this.collisionData=null;this._listeners.render=null;this.addEventListener("render",function(){if(this._dirty||this._previousOffsetX==null){this._dirty=false;this.redraw(0,0,c.width,c.height)}else if(this._offsetX!=this._previousOffsetX||
this._offsetY!=this._previousOffsetY)if(this._tight){var a=-this._offsetX,b=-this._offsetY,e=-this._previousOffsetX,m=-this._previousOffsetY,k=a-e+c.width,h=e-a+c.width,i=b-m+c.height,f=m-b+c.height;if(k>this._tileWidth&&h>this._tileWidth&&i>this._tileHeight&&f>this._tileHeight){var l;if(k<h){l=0;a=e-a;h=k}else{l=a-e;a=0}if(i<f){k=0;b=m-b}else{k=b-m;b=0;i=f}if(c._buffer==null){c._buffer=document.createElement("canvas");c._buffer.width=this._context.canvas.width;c._buffer.height=this._context.canvas.height}f=
c._buffer.getContext("2d");if(this._doubledImage){f.clearRect(0,0,h*2,i*2);f.drawImage(this._context.canvas,l*2,k*2,h*2,i*2,0,0,h*2,i*2);f=this._context;f.clearRect(a*2,b*2,h*2,i*2);f.drawImage(c._buffer,0,0,h*2,i*2,a*2,b*2,h*2,i*2)}else{f.clearRect(0,0,h,i);f.drawImage(this._context.canvas,l,k,h,i,0,0,h,i);f=this._context;f.clearRect(a,b,h,i);f.drawImage(c._buffer,0,0,h,i,a,b,h,i)}a===0?this.redraw(h,0,c.width-h,c.height):this.redraw(0,0,c.width-h,c.height);b===0?this.redraw(0,i,c.width,c.height-
i):this.redraw(0,0,c.width,c.height-i)}else this.redraw(0,0,c.width,c.height)}else this.redraw(0,0,c.width,c.height);this._previousOffsetX=this._offsetX;this._previousOffsetY=this._offsetY})},loadData:function(a){this._data=Array.prototype.slice.apply(arguments);this._dirty=true;this._tight=false;for(var b=0,e=this._data.length;b<e;b++){for(var d=0,c=this._data[b],g=0,m=c.length;g<m;g++)for(var f=0,h=c[g].length;f<h;f++)c[g][f]>=0&&d++;if(d/(c.length*c[0].length)>0.2){this._tight=true;break}}},hitTest:function(a,
b){if(a<0||this.width<=a||b<0||this.height<=b)return false;var e=this._image.width,d=this._image.height,c=this._tileWidth||e,g=this._tileHeight||d,a=a/c|0,b=b/g|0;if(this.collisionData!=null)return this.collisionData[b]&&!!this.collisionData[b][a];for(var f=0,k=this._data.length;f<k;f++){var h=this._data[f],i;if(h[b]!=null&&(i=h[b][a])!=null&&0<=i&&i<(e/c|0)*(d/g|0))return true}return false},image:{get:function(){return this._image},set:function(a){this._image=a;if(p&&c.scale==2){for(var b=new enchant.Surface(a.width*
2,a.height*2),e=this._tileWidth||a.width,d=this._tileHeight||a.height,j=a.width/e|0,g=a.height/d|0,f=0;f<g;f++)for(var k=0;k<j;k++)b.draw(a,k*e,f*d,e,d,k*e*2,f*d*2,e*2,d*2);this._doubledImage=b}this._dirty=true}},tileWidth:{get:function(){return this._tileWidth},set:function(a){this._tileWidth=a;this._dirty=true}},tileHeight:{get:function(){return this._tileHeight},set:function(a){this._tileHeight=a;this._dirty=true}},width:{get:function(){return this._tileWidth*this._data[0][0].length}},height:{get:function(){return this._tileHeight*
this._data[0].length}},redraw:function(a,b,e,d){if(this._image!=null){var c,g,f,k,h;if(this._doubledImage){c=this._doubledImage;g=this._tileWidth*2;f=this._tileHeight*2;k=-this._offsetX*2;h=-this._offsetY*2;a=a*2;b=b*2;e=e*2;d=d*2}else{c=this._image;g=this._tileWidth;f=this._tileHeight;k=-this._offsetX;h=-this._offsetY}var i=c.width/g|0,l=c.height/f|0,n=Math.max((a+k)/g|0,0),o=Math.max((b+h)/f|0,0),p=Math.ceil((a+k+e)/g),q=Math.ceil((b+h+d)/f);c=c._element;var t=this._context;t.clearRect(a,b,e,d);
e=0;for(d=this._data.length;e<d;e++)for(var s=this._data[e],v=Math.min(p,s[0].length),w=Math.min(q,s.length),b=o;b<w;b++)for(a=n;a<v;a++){var r=s[b][a];0<=r&&r<i*l&&t.drawImage(c,r%i*g,(r/i|0)*f,g,f,a*g-k,b*f-h,g,f)}}}});enchant.Group=enchant.Class.create(enchant.Node,{initialize:function(){enchant.Node.call(this);this.childNodes=[];this._y=this._x=0},addChild:function(a){this.childNodes.push(a);a.parentNode=this;a.dispatchEvent(new enchant.Event("added"));if(this.scene){var b=new enchant.Event("addedtoscene");
a.scene=this.scene;a.dispatchEvent(b);a._updateCoordinate();var e=document.createDocumentFragment(),d,c=Array.prototype.push;if(a._element)e.appendChild(a._element);else if(a.childNodes)for(d=a.childNodes.slice().reverse();d.length;){a=d.pop();a.scene=this.scene;a.dispatchEvent(b);a._element?e.appendChild(a._element):a.childNodes&&c.apply(d,a.childNodes.slice().reverse())}if(e.childNodes.length){for(var f,b=this;b.parentNode;){d=b.parentNode.childNodes;for(d=d.slice(d.indexOf(b)+1).reverse();d.length;){a=
d.pop();if(a._element){f=a._element;break}else a.childNodes&&c.apply(d,a.childNodes.slice().reverse())}b=b.parentNode}f?this.scene._element.insertBefore(e,f):this.scene._element.appendChild(e)}}},insertBefore:function(a,b){var c=this.childNodes.indexOf(b);if(c!=-1){this.childNodes.splice(c,0,a);a.parentNode=this;a.dispatchEvent(new enchant.Event("added"));if(this.scene){var d=new enchant.Event("addedtoscene");a.scene=this.scene;a.dispatchEvent(d);a._updateCoordinate();var f=document.createDocumentFragment(),
g,m=Array.prototype.push;if(a._element)f.appendChild(a._element);else if(a.childNodes)for(g=a.childNodes.slice().reverse();g.length;){a=g.pop();a.scene=this.scene;a.dispatchEvent(d);a._element?f.appendChild(a._element):a.childNodes&&m.apply(g,a.childNodes.reverse())}if(f.childNodes.length){for(var k,d=b;d.parentNode;){if(c!=null){g=this.childNodes.slice(c+1).reverse();c=null}else{g=d.parentNode.childNodes;g=g.slice(g.indexOf(d)+1).reverse()}for(;g.length;){a=g.pop();if(a._element){k=a._element;break}else a.childNodes&&
m.apply(g,a.childNodes.slice().reverse())}d=d.parentNode}k?this.scene._element.insertBefore(f,k):this.scene._element.appendChild(f)}}}else this.addChild(a)},removeChild:function(a){var b=this.childNodes.indexOf(a);if(b!=-1){this.childNodes.splice(b,1);a.parentNode=null;a.dispatchEvent(new enchant.Event("removed"));if(this.scene){b=new enchant.Event("removedfromscene");a.scene=null;a.dispatchEvent(b);if(a._element)this.scene._element.removeChild(a._element);else if(a.childNodes)for(var c=a.childNodes.slice(),
d=Array.prototype.push;c.length;){a=c.pop();a.scene=null;a.dispatchEvent(b);a._element?this.scene._element.removeChild(a._element):a.childNodes&&d.apply(c,a.childNodes)}}}},firstChild:{get:function(){return this.childNodes[0]}},lastChild:{get:function(){return this.childNodes[this.childNodes.length-1]}},_updateCoordinate:function(){if(this.parentNode){this._offsetX=this.parentNode._offsetX+this._x;this._offsetY=this.parentNode._offsetY+this._y}else{this._offsetX=this._x;this._offsetY=this._y}for(var a=
0,b=this.childNodes.length;a<b;a++)this.childNodes[a]._updateCoordinate()}});enchant.Scene=enchant.Class.create(enchant.Group,{initialize:function(){enchant.Group.call(this);this._element=document.createElement("div");this._element.style.position="absolute";this._element.style.overflow="hidden";this._element.style.width=(this.width=c.width)+"px";this._element.style.height=(this.height=c.height)+"px";this._element.style[l+"TransformOrigin"]="0 0";this._element.style[l+"Transform"]="scale("+c.scale+
")";this.scene=this;var a=this;if(n){this._element.addEventListener("touchstart",function(b){for(var c=b.touches,d=0,f=c.length;d<f;d++){b=new enchant.Event("touchstart");b.identifier=c[d].identifier;b._initPosition(c[d].pageX,c[d].pageY);a.dispatchEvent(b)}},false);this._element.addEventListener("touchmove",function(b){for(var c=b.touches,d=0,f=c.length;d<f;d++){b=new enchant.Event("touchmove");b.identifier=c[d].identifier;b._initPosition(c[d].pageX,c[d].pageY);a.dispatchEvent(b)}},false);this._element.addEventListener("touchend",
function(b){for(var c=b.changedTouches,d=0,f=c.length;d<f;d++){b=new enchant.Event("touchend");b.identifier=c[d].identifier;b._initPosition(c[d].pageX,c[d].pageY);a.dispatchEvent(b)}},false)}else{this._element.addEventListener("mousedown",function(b){var e=b.pageX,d=b.pageY,b=new enchant.Event("touchstart");b.identifier=c._mousedownID;b._initPosition(e,d);a.dispatchEvent(b);a._mousedown=true},false);c._element.addEventListener("mousemove",function(b){if(a._mousedown){var e=b.pageX,d=b.pageY,b=new enchant.Event("touchmove");
b.identifier=c._mousedownID;b._initPosition(e,d);a.dispatchEvent(b)}},false);c._element.addEventListener("mouseup",function(b){if(a._mousedown){var e=b.pageX,d=b.pageY,b=new enchant.Event("touchend");b.identifier=c._mousedownID;b._initPosition(e,d);a.dispatchEvent(b);a._mousedown=false}},false)}},backgroundColor:{get:function(){return this._backgroundColor},set:function(a){this._element.style.backgroundColor=this._backgroundColor=a}},_updateCoordinate:function(){this._offsetX=this._x;this._offsetY=
this._y;for(var a=0,b=this.childNodes.length;a<b;a++)this.childNodes[a]._updateCoordinate()}});var o=["putImageData","drawImage","drawFocusRing","fill","stroke","clearRect","fillRect","strokeRect","fillText","strokeText"];enchant.Surface=enchant.Class.create(enchant.EventTarget,{initialize:function(a,b){enchant.EventTarget.call(this);this.width=a;this.height=b;this.context=null;var e="enchant-surface"+c._surfaceID++;if(document.getCSSCanvasContext){this.context=document.getCSSCanvasContext("2d",e,
a,b);this._element=this.context.canvas;this._css="-webkit-canvas("+e+")"}else if(document.mozSetImageElement){this._element=document.createElement("canvas");this._element.width=a;this._element.height=b;this._css="-moz-element(#"+e+")";this.context=this._element.getContext("2d");document.mozSetImageElement(e,this._element)}else{this._element=document.createElement("canvas");this._element.width=a;this._element.height=b;this._element.style.position="absolute";this.context=this._element.getContext("2d");
o.forEach(function(a){var b=this.context[a];this.context[a]=function(){b.apply(this,arguments);this._dirty=true}},this)}},getPixel:function(a,b){return this.context.getImageData(a,b,1,1).data},setPixel:function(a,b,c,d,f,g){var m=this.context.createImageData(1,1);m.data[0]=c;m.data[1]=d;m.data[2]=f;m.data[3]=g;this.context.putImageData(m,a,b,1,1)},clear:function(){this.context.clearRect(0,0,this.width,this.height)},draw:function(a){arguments[0]=a=a._element;arguments.length==1?this.context.drawImage(a,
0,0):this.context.drawImage.apply(this.context,arguments)},clone:function(){var a=new enchant.Surface(this.width,this.height);a.draw(this);return a},toDataURL:function(){var a=this._element.src;return a?a.slice(0,5)=="data:"?a:this.clone().toDataURL():this._element.toDataURL()}});enchant.Surface.load=function(a){var b=new Image,c=Object.create(enchant.Surface.prototype,{context:{value:null},_css:{value:"url("+a+")"},_element:{value:b}});enchant.EventTarget.call(c);b.src=a;b.onerror=function(){throw Error("Cannot load an asset: "+
b.src);};b.onload=function(){c.width=b.width;c.height=b.height;c.dispatchEvent(new enchant.Event("load"))};return c};enchant.Sound=enchant.Class.create(enchant.EventTarget,{initialize:function(){enchant.EventTarget.call(this);this.duration=0;throw Error("Illegal Constructor");},play:function(){this._element&&this._element.play()},pause:function(){this._element&&this._element.pause()},stop:function(){this.pause();this.currentTime=0},clone:function(){var a;if(this._element instanceof Audio)a=Object.create(enchant.Sound.prototype,
{_element:{value:this._element.cloneNode(false)},duration:{value:this.duration}});else{if(q)return this;a=Object.create(enchant.Sound.prototype)}enchant.EventTarget.call(a);return a},currentTime:{get:function(){return this._element?this._element.currentTime:0},set:function(a){if(this._element)this._element.currentTime=a}},volume:{get:function(){return this._element?this._element.volume:1},set:function(a){if(this._element)this._element.volume=a}}});enchant.Sound.load=function(a,b){if(b===null)var e=
f(a),b=e?"audio/"+e:"";var b=b.replace("mp3","mpeg"),d=Object.create(enchant.Sound.prototype);enchant.EventTarget.call(d);var j=new Audio;if(!enchant.Sound.enabledInMobileSafari&&l=="webkit"&&n)window.setTimeout(function(){d.dispatchEvent(new enchant.Event("load"))},0);else if(!q&&j.canPlayType(b)){j.src=a;j.load();j.autoplay=false;j.onerror=function(){throw Error("Cannot load an asset: "+j.src);};j.addEventListener("canplaythrough",function(){d.duration=j.duration;d.dispatchEvent(new enchant.Event("load"))},
false);d._element=j}else if(b=="audio/mpeg"){var g=document.createElement("embed"),e="enchant-audio"+c._soundID++;g.width=g.height=1;g.name=e;g.src="sound.swf?id="+e+"&src="+a;g.allowscriptaccess="always";g.style.position="absolute";g.style.left="-1px";d.addEventListener("load",function(){Object.defineProperties(g,{currentTime:{get:function(){return g.getCurrentTime()},set:function(a){g.setCurrentTime(a)}},volume:{get:function(){return g.getVolume()},set:function(a){g.setVolume(a)}}});d._element=
g;d.duration=g.getDuration()});c._element.appendChild(g);enchant.Sound[e]=d}else window.setTimeout(function(){d.dispatchEvent(new enchant.Event("load"))},0);return d};window.addEventListener("message",function(a){a=JSON.parse(a.data);if(a.type=="event")c.dispatchEvent(new Event(a.value));else if(a.type=="debug")switch(a.value){case "start":enchant.Game.instance.start();break;case "pause":enchant.Game.instance.pause();break;case "resume":enchant.Game.instance.resume();break;case "tick":enchant.Game.instance._tick()}},
false);enchant.Sound.enabledInMobileSafari=false})();
